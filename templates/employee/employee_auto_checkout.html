<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ph√≤ng qu√° h·∫°n c·∫ßn checkout</title>

  <!-- Bootstrap + Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">

  <style>
    /* ===== SIDEBAR (gi·ªëng m·∫´u) ===== */
    .sidebar {
      height: 100vh; position: fixed; top: 0; left: 0;
      width: 250px; background-color: #2c3e50; padding-top: 20px; overflow-y: auto;
    }
    .sidebar a {
      color: #ecf0f1; padding: 15px; text-decoration: none; display: block; transition: background .15s ease;
    }
    .sidebar a:hover { background-color: #34495e; }
    .sidebar a.active { background-color: #34495e; color: #fff; font-weight: 600; }

    /* ===== CONTENT (gi·ªëng m·∫´u) ===== */
    .content { margin-left: 250px; padding: 20px; background: #f8f9fa; min-height: 100vh; }
    .card-header { background-color: #3498db; color: #fff; }
    .table thead th { background-color: #ecf0f1; }
    .table-hover tbody tr:hover { background-color: #f1f8ff; transition: background-color .2s; }

    .price { font-variant-numeric: tabular-nums; }
  </style>
</head>
<body>

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h4 class="text-center text-white mb-4">Ch·ª©c nƒÉng</h4>
    <a href="{{ url_for('employee.employee_booking') }}"><i class="fas fa-calendar-check me-2"></i> Qu·∫£n l√Ω ƒë·∫∑t ph√≤ng</a>
    <a href="{{ url_for('employee.checkin') }}"><i class="fas fa-sign-in-alt me-2"></i> X√°c nh·∫≠n check-in</a>
    <a href="{{ url_for('employee.search_room') }}"><i class="fas fa-search me-2"></i> T√¨m ki·∫øm ph√≤ng</a>
    <a href="{{ url_for('employee.employee_services') }}"><i class="fas fa-concierge-bell me-2"></i> Qu·∫£n l√Ω d·ªãch v·ª•</a>
    <a href="{{ url_for('employee.employee_customers') }}"><i class="fas fa-users me-2"></i> Qu·∫£n l√Ω kh√°ch h√†ng</a>
    <a href="{{ url_for('employee.checkout') }}"><i class="fas fa-sign-out-alt me-2"></i> X√°c nh·∫≠n checkout</a>
    <a href="{{ url_for('employee.paid_bookings') }}"><i class="fas fa-file-invoice-dollar me-2"></i> Ph√≤ng ƒê√£ Thanh To√°n</a>
    <!-- Trang hi·ªán t·∫°i -> active d√πng #34495e -->
    <a href="{{ url_for('employee.employee_auto_checkout') }}" class="active">
      <i class="fas fa-clock me-2"></i> Ph√≤ng qu√° h·∫°n c·∫ßn checkout
      {% if expired_count and expired_count > 0 %}
        <span class="badge bg-danger ms-1">{{ expired_count }}</span>
      {% endif %}
    </a>
  </div>

  <!-- CONTENT -->
  <div class="content">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2 class="mb-1">Qu·∫£n l√Ω ph√≤ng qu√° h·∫°n - L·ªÖ t√¢n</h2>
        <div class="text-muted small">H√¥m nay: <strong>{{ today }}</strong></div>
      </div>
      <div>
        <span>Xin ch√†o, {{ user.hoten }} ({{ user.chucvu }})</span>
        <a href="{{ url_for('admin.admin_logout') }}" class="btn btn-danger ms-3">ƒêƒÉng xu·∫•t</a>
      </div>
    </div>

    <div class="card shadow-sm">
      <div class="card-header">
        Danh s√°ch ph√≤ng qu√° h·∫°n c·∫ßn checkout
      </div>
      <div class="card-body">

        {% if expired_bookings %}
        <form method="POST">
          <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
              <thead>
                <tr>
                  <th class="text-center" style="width:48px;">
                    <input class="form-check-input" type="checkbox" id="select-all">
                  </th>
                  <th>M√£ ƒë·∫∑t ph√≤ng</th>
                  <th>Ph√≤ng</th>
                  <th>Lo·∫°i ph√≤ng</th>
                  <th>Kh√°ch h√†ng</th>
                  <th>Ng√†y nh·∫≠n</th>
                  <th>Ng√†y tr·∫£</th>
                  <th>Tr·∫°ng th√°i</th>
                  <th class="text-end">T·ªïng ti·ªÅn</th>
                </tr>
              </thead>
              <tbody>
                {% for b in expired_bookings %}
                <tr>
                  <td class="text-center">
                    <input class="form-check-input" type="checkbox" name="selected_ids" value="{{ b.madatphong }}">
                  </td>
                  <td class="fw-semibold">#{{ b.madatphong }}</td>
                  <td>{{ b.maphong }}</td>
                  <td>{{ b.phong.loaiphong if b.phong else '‚Äî' }}</td>
                  <td>{{ b.khachhang.hoten if b.khachhang else '‚Äî' }}</td>
                  <td>{{ b.ngaynhanphong }}</td>
                  <td class="text-danger fw-semibold">{{ b.ngaytraphong }}</td>
                  <td>{{ b.trangthai }}</td>
                  <td class="text-end price">
                    {{ "{:,.0f}".format(b.tongtien|default(0))|replace(',', '.') }}‚Ç´
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <div class="mt-3 d-flex justify-content-between align-items-center">
            <div class="text-muted small">
              <i class="fa-regular fa-circle-question me-1"></i> T√≠ch ch·ªçn c√°c ph√≤ng c·∫ßn x√°c nh·∫≠n tr·∫£.
            </div>
            <button type="submit" class="btn btn-primary">
              ‚úÖ X√°c nh·∫≠n tr·∫£ ph√≤ng ƒë√£ ch·ªçn
            </button>
          </div>
        </form>

        {% else %}
          <div class="alert alert-success text-center mb-0" role="alert">
            Kh√¥ng c√≥ ph√≤ng n√†o qu√° h·∫°n h√¥m nay üéâ
          </div>
        {% endif %}

      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Ch·ªçn t·∫•t c·∫£
    const selectAll = document.getElementById('select-all');
    if (selectAll) {
      selectAll.addEventListener('change', (e) => {
        document.querySelectorAll('input[name="selected_ids"]').forEach(cb => cb.checked = e.target.checked);
      });
    }
  </script>
</body>
</html>
