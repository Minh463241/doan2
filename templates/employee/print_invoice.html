<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>H√≥a ƒë∆°n #{{ mahoadon }}</title>
  <style>
    :root { --text:#111; --muted:#555; --border:#000; }
    html, body { font-family: Arial, sans-serif; color: var(--text); margin: 0; padding: 0; font-size: 12pt; }
    @page { size: A4 portrait; margin: 12mm; }
    .wrap { max-width: 800px; margin: 0 auto; padding: 16px; }
    .invoice-header { text-align: center; border-bottom: 2px solid var(--border); padding-bottom: 8px; margin-bottom: 16px; }
    .invoice-header h2 { margin: 0 0 4px 0; font-size: 22pt; letter-spacing: .5px; }
    .subline { font-size: 10pt; color: var(--muted); }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px 24px; margin-bottom: 12px; }
    .field { margin: 2px 0; }
    .label { display:inline-block; min-width: 140px; color: var(--muted); }
    table { width: 100%; border-collapse: collapse; margin-top: 8px; font-size: 11pt; }
    th, td { border: 1px solid #000; padding: 8px; vertical-align: top; }
    th { background: #f7f7f7; text-align: left; }
    .text-right { text-align: right; }
    .total-row td { font-weight: bold; border-top: 2px solid var(--border); }
    .footer { margin-top: 16px; display: flex; justify-content: space-between; gap: 12px; font-size: 10.5pt; }
    .sign { margin-top: 40px; text-align: center; }
    .no-print { display: inline-block; margin: 12px 16px; }
    @media print { .no-print { display: none !important; } .wrap { padding: 0; } }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Thanh t√°c v·ª• khi xem tr√™n tr√¨nh duy·ªát -->
    <div class="no-print" style="text-align:right;">
      <button onclick="window.print()">üñ®Ô∏è In h√≥a ƒë∆°n</button>
      {% if madatphong is defined %}
      <a href="{{ url_for('employee.print_invoice_pdf', madatphong=madatphong) }}">‚¨áÔ∏è T·∫£i PDF</a>
      {% endif %}
    </div>

    <div class="invoice-header">
      <h2>H√ìA ƒê∆†N THANH TO√ÅN</h2>
      <div class="subline">KeiWei Hotel ‚Ä¢ Hotline: 09xx xxx xxx ‚Ä¢ ƒê·ªãa ch·ªâ: ‚Ä¶</div>
    </div>

    <!-- Th√¥ng tin chung -->
    <div class="grid">
      <div>
        <div class="field"><span class="label">M√£ h√≥a ƒë∆°n:</span> <strong>#{{ mahoadon }}</strong></div>
        <div class="field"><span class="label">M√£ ƒë·∫∑t ph√≤ng:</span> <strong>#{{ madatphong }}</strong></div>
        <div class="field"><span class="label">Ph√≤ng ƒë√£ s·ª≠ d·ª•ng:</span> {{ phong }}</div>
      </div>
      <div>
        <div class="field"><span class="label">Ng∆∞·ªùi l·∫≠p:</span> {{ nguoi_lap }}</div>
        <div class="field"><span class="label">Nh√¢n vi√™n in:</span> {{ nhan_vien_letan }}</div>
        <div class="field"><span class="label">Ng√†y l·∫≠p:</span> {{ ngay_lap }}</div>
        <div class="field"><span class="label">Ng√†y thanh to√°n / In:</span> {{ printed_at if printed_at is defined else ngay_thanh_toan }}</div>
      </div>
    </div>

    <!-- Chi ti·∫øt thanh to√°n -->
    <h3 style="margin: 10px 0 6px 0;">Chi ti·∫øt thanh to√°n</h3>
    <table>
      <thead>
        <tr>
          <th style="width: 46%;">Kho·∫£n chi</th>
          <th style="width: 10%;">SL</th>
          <th style="width: 22%;" class="text-right">ƒê∆°n gi√° (VND)</th>
          <th style="width: 22%;" class="text-right">Th√†nh ti·ªÅn (VND)</th>
        </tr>
      </thead>
      <tbody>
        <!-- D√≤ng ti·ªÅn ph√≤ng -->
        <tr>
          <td>Ti·ªÅn ph√≤ng</td>
          <td class="text-right">1</td>
          <td class="text-right">{{ '{:,.0f}'.format(tien_phong|default(0))|replace(',', '.') }}</td>
          <td class="text-right">{{ '{:,.0f}'.format(tien_phong|default(0))|replace(',', '.') }}</td>
        </tr>

        <!-- C√°c d·ªãch v·ª• -->
        {% for c in charges %}
        <tr>
          <td>{{ c.name }}</td>
          <td class="text-right">{{ c.qty }}</td>
          <td class="text-right">{{ '{:,.0f}'.format(c.unit_price|default(0))|replace(',', '.') }}</td>
          <td class="text-right">{{ '{:,.0f}'.format(c.amount|default(0))|replace(',', '.') }}</td>
        </tr>
        {% endfor %}

        <!-- T·ªïng d·ªãch v·ª• -->
        <tr>
          <td colspan="3" class="text-right"><strong>T·ªïng d·ªãch v·ª•</strong></td>
          <td class="text-right"><strong>{{ '{:,.0f}'.format(tien_dich_vu|default(0))|replace(',', '.') }}</strong></td>
        </tr>

        <!-- T·ªïng c·ªông -->
        <tr class="total-row">
          <td colspan="3" class="text-right">T·ªîNG C·ªòNG</td>
          <td class="text-right"><strong>{{ '{:,.0f}'.format(so_tien|default(0))|replace(',', '.') }}</strong></td>
        </tr>
      </tbody>
    </table>

    <!-- Ghi ch√∫ & ch·ªØ k√Ω -->
    <div class="footer">
      <div>
        <div><em>Ghi ch√∫:</em> Vui l√≤ng ki·ªÉm tra k·ªπ th√¥ng tin tr∆∞·ªõc khi r·ªùi qu·∫ßy.</div>
        <div>In l√∫c: {{ printed_at if printed_at is defined else ngay_thanh_toan }}</div>
        <div>Nh√¢n vi√™n l·ªÖ t√¢n in h√≥a ƒë∆°n: <strong>{{ nhan_vien_letan }}</strong></div>
      </div>
      <div class="sign">
        <div><strong>Ng∆∞·ªùi l·∫≠p h√≥a ƒë∆°n</strong></div>
        <div style="margin-top:60px;">{{ nguoi_lap }}</div>
      </div>
    </div>
  </div>
</body>
</html>
